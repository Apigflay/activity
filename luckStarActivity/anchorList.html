<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">
<meta name="description" content="不超过150个字符"/>
<meta name="keywords" content=""/>
<meta content="" name="author"/>
<title></title>
<link rel="stylesheet" href="./anchorList.css">
<script src="./axios.js"></script>
<script src="./vue.js"></script>
<!-- 引入样式 -->
<!-- <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"> -->
<!-- 引入组件库 // that.$message(response.data.msg); -->
<!-- <script src="https://unpkg.com/element-ui/lib/index.js"></script> -->
<!-- 引入样式文件 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.10/lib/index.css">
<!-- <link rel="stylesheet" href="./vant.js"> -->
<!-- 引入 Vue 和 Vant 的 JS 文件 -->
<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vant@2.10/lib/vant.min.js"></script>
<!-- <script src="./vant.js"></script> -->

<script type="text/javascript">
//引入该flexible.min.js
!function(e,t){function n(){var n=l.getBoundingClientRect().width;t=t||540,n>t&&(n=t);var i=100*n/e;r.innerHTML="html{font-size:"+i+"px;}"}var i,d=document,o=window,l=d.documentElement,r=document.createElement("style");if(l.firstElementChild)l.firstElementChild.appendChild(r);else{var a=d.createElement("div");a.appendChild(r),d.write(a.innerHTML),a=null}n(),o.addEventListener("resize",function(){clearTimeout(i),i=setTimeout(n,300)},!1),o.addEventListener("pageshow",function(e){e.persisted&&(clearTimeout(i),i=setTimeout(n,300))},!1),"complete"===d.readyState?d.body.style.fontSize="16px":d.addEventListener("DOMContentLoaded",function(e){d.body.style.fontSize="16px"},!1)}(750,750);
</script>
</head>
  <body>
    <div id="app">
        <div class="contenter">
            <div class="topArea">
                <div class="titleText">{{luckTitleText[language]}}</div>
                <div class="priseIcon" @click="goPages(0)">{{acPriseText[language]}}</div>
                <div class="acTime">{{timeInfo[language]}}</div>
                <div class="ruleBtnArea">
                    <div class="ruleIcon" @click="goPages(1)">{{acRuleText[language]}}</div>
                </div>
            </div>
            <!-- 用户礼物宝箱 -->
            <div class="userBoxArea">
                <div class="userBoxTitle">
                  <div class="userUtitle">{{userBoxTitle[language]}}</div>
                </div>
                <div class="userBox">
                    <img class="img1" src="./img/line1.png" alt="">
                    <img class="img2" src="./img/line1.png" alt="">
                    <div class="content">
                        <div class="perBox" @click="openBox(1)">
                          <img class="img" src="./img/img11.png" alt="" v-if="giftStatus[0].status==0">
                          <img class="img" src="./img/img1.png" alt="" v-if="giftStatus[0].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[0].status==0&&userLevalNum>=100000">
                          <span class="hNum" v-if="giftStatus[0].status==1&&giftStatus[0].coin>0">{{giftStatus[0].coin}}</span>

                          <span class="price">100000</span>
                        </div>
                        <div class="lineH"></div>
                        <div class="perBox" @click="openBox(2)">
                          <img class="img" src="./img/img22.png" alt="" v-if="giftStatus[1].status==0">
                          <img class="img" src="./img/img2.png" alt="" v-if="giftStatus[1].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[1].status==0&&userLevalNum>=200000">
                          <span class="hNum" v-if="giftStatus[1].status==1&&giftStatus[1].coin>0">{{giftStatus[1].coin}}</span>

                          <span class="price">200000</span>
                        </div>
                        <div class="lineH"></div>
                        <div class="perBox" @click="openBox(3)">    
                          <img class="img" src="./img/img33.png" alt="" v-if="giftStatus[2].status==0">
                          <img class="img" src="./img/img3.png" alt="" v-if="giftStatus[2].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[2].status==0&&userLevalNum>=500000">
                          <span class="hNum" v-if="giftStatus[2].status==1&&giftStatus[2].coin>0">{{giftStatus[2].coin}}</span>

                          <span class="price">500000</span>
                        </div>


                    </div>
                </div>
            </div>
            <!-- 主播礼物宝箱 -->
            <div class="AchorBoxArea">
                <div class="userBoxTitle">
                  <div class="userUtitle">{{achorBoxTitle[language]}}</div>
                </div>
                <div class="userBox">
                    <img class="img1" src="./img/line1.png" alt="">
                    <img class="img2" src="./img/line1.png" alt="">
                    <div class="content">
                        <div class="perBox" @click="openBox(4)">
                          <img class="img" src="./img/img11.png" alt="" v-if="giftStatus[3].status==0">
                          <img class="img" src="./img/img1.png" alt="" v-if="giftStatus[3].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[3].status==0&&userLevalNum>=1000000">
                          <span class="hNum" v-if="giftStatus[3].status==1&&giftStatus[3].coin>0">{{giftStatus[3].coin}}</span>
                          <span class="price">1000000</span>
                        </div>
                        <div class="lineH"></div>
                        <div class="perBox"  @click="openBox(5)">
                        <img class="img" src="./img/img22.png" alt="" v-if="giftStatus[4].status==0">
                          <img class="img" src="./img/img2.png" alt="" v-if="giftStatus[4].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[4].status==0&&userLevalNum>=2000000">
                          <span class="hNum" v-if="giftStatus[4].status==1&&giftStatus[4].coin>0">{{giftStatus[4].coin}}</span>

                          <span class="price">2000000</span>
                        </div>
                        <div class="lineH"></div>
                        <div class="perBox"  @click="openBox(6)">    
                          <img class="img" src="./img/img33.png" alt="" v-if="giftStatus[5].status==0">
                          <img class="img" src="./img/img3.png" alt="" v-if="giftStatus[5].status==1">
                          <img class="ok" src="./img/ok.png" alt="" v-if="giftStatus[5].status==0&&userLevalNum>=5000000">
                          <span class="hNum" v-if="giftStatus[5].status==1&&giftStatus[5].coin>0">{{giftStatus[5].coin}}</span>

                          <span class="price">5000000</span>
                        </div>


                    </div>
                </div>
            </div>
            <!-- 活动礼物 -->
             <div class="AcBoxArea">
                <div class="userBoxTitle">
                  <div class="userUtitle">{{acBoxTitle[language]}}</div>
                </div>
                <div class="userBox">
                    <div class="content">
                        <div class="perBox" v-for="(item,index) in giftData" :key="index">
                          <img class="img" :src="item.url" alt="">
                          <span class="price">{{item.name[language]}}</span>
                          <span class="num">{{item.num}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 榜单 -->
            <div class="rankArea">
                <div class="rankTitle">
                    <div class="perRankTitle " :class="acRankStatus==0?'perRankTitleAc':''" @click="swichRankList(0)">{{luckAchorText[language]}}</div>
                    <div class="perRankTitle" :class="acRankStatus==1?'perRankTitleAc':''" @click="swichRankList(1)">{{luckUserText[language]}}</div>
                </div>
                <!-- 主播 -->
                <div class="rankList" v-if="acRankStatus==0">
                    <div class="perList" v-for="(item,index) in achorRankData" :key="index">
                        <div class="num">{{item.pos}}</div>
                        <img class="photo" :src="item.smallpic" alt="" @click="gooPersonalPage(item.useridx)">
                        <div class="nickName" @click="gooPersonalPage(item.useridx)">{{item.myname}}</div>
                        <div class="money">
                          {{engText[language]}}<br>
                          {{item.AllPower}}
                        </div>
                    </div>
                </div>
                <div class="perListBottom" v-if="acRankStatus==0">
                    <div class="num" v-if="achorMydata.rowNo!=0">{{achorMydata.rowNo}}</div>
                    <div class="num" v-if="achorMydata.rowNo==0">No</div>
                    <img class="photo" :src="achorMydata.smallpic" alt=""  >
                    <div class="nickName"  >{{achorMydata.myname}}</div>
                    <div class="money" >
                      {{engText[language]}}<br>
                      {{achorMydata.giftnum}}
                    </div>
                    <!-- <div class="no" v-if="achorMydata.rowNo==0">{{noText[language]}}</div> -->
                </div>
                <!-- 用户 -->
                 <div class="rankList" v-if="acRankStatus==1">
                    <div class="perList" v-for="(item,index) in userRankData" :key="index">
                        <div class="num">{{item.pos}}</div>
                        <img class="photo" :src="item.smallpic" alt="" @click="gooPersonalPage(item.useridx)">
                        <div class="nickName" @click="gooPersonalPage(item.useridx)">{{item.myname}}</div>
                        <div class="money">
                          {{engText[language]}}<br>
                          {{item.AllPower}}
                        </div>
                    </div>
                </div>
                <div class="perListBottom" v-if="acRankStatus==1">
                    <div class="num" v-if="userMyData.rowNo!=0">{{userMyData.rowNo}}</div>
                    <div class="num" v-if="userMyData.rowNo==0">No</div>
                    <img class="photo" :src="userMyData.smallpic" alt="" >
                    <div class="nickName" >{{userMyData.myname}}</div>
                    <div class="money"  >
                      {{engText[language]}}<br>
                      {{userMyData.giftnum}}
                    </div>
                    <!-- <div class="no" v-if="userMyData.rowNo==0">{{noText[language]}}</div> -->
                </div>
            </div>

        </div>
    </div>
    <!-- built files will be auto injected -->
  </body>
  <script type="text/javascript">
    new Vue({
        el:'#app',
        data(){
          return{
            webUrl:'https://api.bunnylive.me/',//web before https://api.bunnylive.me/  test  http://173.248.234.130:2027/
            language:0,//0中   1英   2太
            luckTitleText:['Lucky Star','Lucky Star','Lucky Star'],//tip title 2021.01.29 00:00-2021.02.02 23:59
            timeInfo:['2021.01.29 00:00-2021.02.02 23:59','2021.01.29 00:00-2021.02.02 23:59','2021.01.29 00:00-2021.02.02 23:59'], 
            acPriseText:['活动奖励','Activity Award','Phần thưởng event'],
            acRuleText:['活动规则','Activity Rules','Luật event'],
            userBoxTitle:['幸运用户宝箱','Lucky User Treasure Box','Hòm báu vật của user may mắn'],
            achorBoxTitle:['幸运主播宝箱','Lucky idol treasure chest','Hòm báu vật của idol may mắn'],
            acBoxTitle:['活动礼物','Activity gift','Quà tặng hoạt động'],
            giftData:[{url:'./img/gift1.png',name:['幸运铃铛','Lucky bell','Chuông may mắn'],num:'40'},
                      {url:'./img/gift2.png',name:['炸了','Blasted','Nổ rồi'],num:'40'},
                      {url:'./img/gift3.png',name:['666','Fa-fa-fabulous!!!','666'],num:'60'},
                      {url:'./img/gift4.png',name:['桃花朵朵开','Blooming peach bloss','Đào hoa nở rộ'],num:'60'},
                      {url:'./img/gift5.png',name:['喜欢你','I like you','Tôi thích bạn'],num:'80'},
                      {url:'./img/gift6.png',name:['幸运大蕉','Lucky banana','Trái chuối may mắn'],num:'100'},
                      {url:'./img/gift7.png',name:['幸运棒棒糖','Lucky lollipop','Kẹo may mắn'],num:'300'},
                      {url:'./img/gift8.png',name:['幸运双人床','Lovely double bed','Giường đôi hạnh phúc'],num:'200'},],
            luckAchorText:['幸运主播','Lucky idol','Idol may mắn'],
            luckUserText:['幸运用户','Lucky user','User may mắn'],
            acRankStatus:0,// 0 主播 1用户
            giftStatus:[{id:1,status:0,coin:0},{id:2,status:0,coin:0},{id:3,status:0,coin:0},{id:4,status:0,coin:0},{id:5,status:0,coin:0},{id:6,status:0,coin:0}],//0 为开奖  1 已开奖
            totalInitData:null,//初始榜单信息
            userRankData:null,//用户榜单信息
            userMyData:{giftnum:0,myname:null,rowNo:0,smallpic:null,useridx:0},//
            achorRankData:null,//主播榜单信息
            achorMydata:{giftnum:0,myname:null,rowNo:0,smallpic:null,useridx:0},//
            engText:['能量值','Energy value','giá trị năng lượng'],
            noText:['未上榜,请切换榜单查看参赛情况。','Not on the list, please switch the list to check the status of the competition.','Khong chi trong danh sach, chuyen gia danh cho minh de kiem tra tien ve cuoc thi.'],
            userLevalNum:0,//用户能量值 判断宝箱是否达到打开标准
            achorLevalNum:0,//主播能量值 


            noData:['暂无数据','No data','Chưa có dữ liệu '],//暂无数据  
            notInList:['暂未上榜','Not yet on the list','Không có trong danh sách'],//暂未上榜 
          }   
        },
        created() {
          this.getInitLunguage()
          this.getInitGiftMsg()
          this.getRankList(this.acRankStatus)

        },
        computed:{
        },
        methods:{
            //获取 token ranktype 等公共函数
            GetQueryString:function(name) { //name为要获得的参数名字 
              var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)")
              var r = window.location.search.substr(1).match(reg)
              if(r != null) return decodeURI(r[2])
              return null;
              // if(r != null){
              //     this.language=decodeURI(r[2])
              // }else{
              //     this.language=0;
              // }
            },
            getInitLunguage:function(){
              var lang = navigator.language||navigator.userLanguage;//常规浏览器语言和IE浏览器
              lang = lang.substr(0, 2);//截取lang前2位字符
              console.log(lang)
              if(lang == 'zh'){
                this.language=0;
              }else if(lang == 'en'){
                this.language=1;
              }else if(lang == 'vi'){
                this.language=2;
              }else{
                this.language=0;
              }
            },
            swichRankList:function(id){//切换榜单
              console.log(id)
              this.acRankStatus=id;
            },
            goPages:function(id){
              console.log(id)
              if(id==0){//奖励
                window.location.href ="./down.html"; rel="external nofollow";
              }else if(id==1){//规则
                window.location.href ="./rule.html"; rel="external nofollow";
              }
            },
            getInitGiftMsg:function(){
              var token = this.GetQueryString('token')
              // console.log(token)
              var url = this.webUrl+'H5/Active/LuckyStarBoxStatus';
              var that =this;
              axios.post(url, {
                token:token
              })
              .then(function (response) {
                console.log(response.data)
                var initData=that.giftStatus;
                var newData=response.data.data;

                initData.forEach(function(item,index){
                  newData.forEach(function(item1,index1){
                    if(item1.BoxType==item.id){
                      that.giftStatus[index].status=1;
                      that.giftStatus[index].coin=item1.Coin;
                    }
                  })
                })
                
               
              })
              .catch(function (error) {
                console.log(error);
              });
            },
            openBox:function(typeId){
              var token = this.GetQueryString('token')
              var url = this.webUrl+'H5/Active/LuckyStarOpenPrize';
              var that = this;
              axios.post(url, {
                token:token,
                Type:typeId
              })
              .then(function (response) {
                // console.log(response.data)
                  if(response.data.code==100){
                    that.giftStatus[typeId-1].coin=response.data.data;
                    that.giftStatus[typeId-1].status=1;
                  
                  }
                  vant.Toast(response.data.msg);
              })
              .catch(function (error) {
                console.log(error);
              });
            },
            getRankList:function(rankId){
              // console.log(rankId)
              // console.log(this.acRankStatus)

              var token = this.GetQueryString('token')
              // console.log(token)
              var url = this.webUrl+'H5/Active/LuckyStarRank';
              var that =this;
              axios.post(url, {
                token:token
              })
              .then(function (response) {
                // console.log(response.data.data)
                that.totalInitData=response.data.data;
                that.achorRankData=response.data.data.idollist;//主播榜
                that.achorMydata=response.data.data.myidolrank;//主播  我的
                that.userRankData=response.data.data.userlist;//用户榜
                that.userMyData=response.data.data.myuserrank;//用户  我的
                that.achorLevalNum=response.data.data.myidolrank.giftnum;//主播
                that.userLevalNum=response.data.data.myuserrank.giftnum;//用户


              })
              .catch(function (error) {
                console.log(error);
              });
            },
            productType:function(){
              var ios = 'ios';
              var android = 'android';
              var u = navigator.userAgent, app = navigator.appVersion;
              var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
              var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
              if (isAndroid) {
                 //这个是安卓操作系统
                 return 1;
              }
              if (isIOS) {
              　　//这个是ios操作系统
                return 0;
              }
            },
            gooPersonalPage:function(idx){//0 i0s 1 android
              // console.log(idx)
              // console.log(this.productType())
              if(this.productType()==0){
                document.location = "miaobowpa:/ShowCard&useridx=" + idx + "&";
              }else if(this.productType()==1){
                window.location.href = "miaobowpa://ShowCard?useridx=" + idx;
              }
            },


            getScrollMsg:function(){
                var that = this;
                window.onscroll = function(){  // 由于需要使用 onPageScroll 无法使用 scroll-view 所以使用onscroll来判断页面是否滚动到底部
                    //变量scrollTop是滚动条滚动时，距离顶部的距离
                    var scrollTop = document.documentElement.scrollTop;
                    //变量windowHeight是可视区的高度
                    var windowHeight = document.documentElement.clientHeight;
                    //变量scrollHeight是滚动条的总高度
                    var scrollHeight = document.documentElement.scrollHeight;
                            console.log(scrollTop)
                            console.log(windowHeight)
                            console.log(scrollHeight)
                          //滚动条到底部的条件
                    if(scrollTop+windowHeight==scrollHeight){
                      //写后台加载数据的函数
                      console.log("距顶部"+scrollTop+"可视区高度"+windowHeight+"滚动条总高度"+scrollHeight);
                      console.log('滚动到底')
                      that.listData.push({name:'小野444猫',num:123,url:'./img/bg10.png'},)

                    }   
                }
            },
          
        },
        beforeMount(){
        },
        mounted(){
        },
       
    })
  </script>
</html>
